# إعداد تطبيق Electron مع الخادم الخلفي

## المشكلة
في تطبيق Electron، المرفقات والصور لا تظهر بشكل صحيح لأن التطبيق يعمل من ملفات محلية ولا يمكنه الوصول إلى الخادم الخلفي عبر المسارات النسبية.

## الحل
تم إصلاح المشكلة بتحديث الكود لاستخدام URL كامل للخادم الخلفي في Electron.

## خطوات التشغيل

### 1. تشغيل الخادم الخلفي
```bash
cd backend
npm start
```
الخادم سيعمل على `http://localhost:3000`

### 2. تشغيل تطبيق Electron
```bash
cd frontend
npm run electron
```

### 3. إعداد متغير البيئة (اختياري)
يمكنك تحديد URL الخادم الخلفي عبر متغير البيئة:
```bash
# Windows
set BACKEND_URL=http://localhost:3000
npm run electron

# Linux/Mac
BACKEND_URL=http://localhost:3000 npm run electron
```

## التحديثات المطبقة

### 1. تحديث `electron-main.cjs`
- إضافة إعدادات للخادم الخلفي
- تعطيل `webSecurity` للسماح بتحميل الصور من مصادر خارجية
- إضافة متغيرات البيئة للوصول إلى الخادم الخلفي

### 2. تحديث `api.js`
- إضافة منطق للكشف عن بيئة Electron
- استخدام URL كامل للخادم الخلفي في Electron

### 3. تحديث `InlineImage.jsx`
- إضافة منطق لبناء URL الصحيح للصور
- تحسين معالجة الأخطاء

### 4. تحديث الصفحات
- تحديث `ManagerDashboard.jsx`
- تحديث `AdminPermissionRequests.jsx`
- تحديث `TicketDetail.jsx`
- استخدام `InlineImage` بدلاً من `<img>` المباشر

## ميزات الإصلاح

✅ **عرض الصور**: المرفقات والصور تظهر بشكل صحيح في Electron  
✅ **روابط التحميل**: روابط التحميل تعمل بشكل صحيح  
✅ **معاينة الصور**: معاينة الصور تعمل في النوافذ المنبثقة  
✅ **توافق مع الويب**: لا يؤثر على نسخة الويب  

## استكشاف الأخطاء

### إذا لم تظهر الصور:
1. تأكد من تشغيل الخادم الخلفي على `http://localhost:3000`
2. تحقق من وحدة تحكم المتصفح للأخطاء
3. تأكد من أن الخادم الخلفي يستجيب لطلبات API

### إذا لم تعمل الروابط:
1. تأكد من إعدادات CORS في الخادم الخلفي
2. تحقق من أن الخادم يسمح بالطلبات من `file://` origin

### إذا كان التطبيق بطيء:
1. تحقق من اتصال الشبكة بالخادم الخلفي
2. تأكد من أن الخادم الخلفي يعمل بشكل صحيح

## ملاحظات مهمة

- يجب تشغيل الخادم الخلفي قبل تشغيل تطبيق Electron
- في بيئة الإنتاج، قد تحتاج لتغيير `BACKEND_URL` إلى عنوان الخادم الفعلي
- تأكد من أن الخادم الخلفي يدعم CORS للطلبات من Electron

---
**المطور**: 3mas  
**الإصدار**: 1.0.0 